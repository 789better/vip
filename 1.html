<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=yes">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.16.0/sdk.js"></script>

  </head>


  <body>
<script>
function random_pick(input){
      if (!(Array.isArray(input))){return input;}
      var input_2 = input[Math.floor(Math.random() * input.length)];
      if (input_2 === undefined){input_2 = input[0];}
      return input_2;
    }
function makeRequest (method, url, data) {
  return new Promise(function (resolve, reject) {
    var xhr = new XMLHttpRequest();
    xhr.open(method, url);
    xhr.onload = function () {
      if (this.status >= 200 && this.status < 300) {
        resolve(xhr.response);
      } else {
        reject({
          status: this.status,
          statusText: xhr.statusText
        });
      }
    };
    xhr.onerror = function () {
      reject({
        status: this.status,
        statusText: xhr.statusText
      });
    };
    if(method=="POST" && data){
        xhr.send(data);
    }else{
        xhr.send();
    }
  });
}
		async function getUserProfile() {
    profile = await liff.getProfile()
    pictureUrl = profile.pictureUrl
    userId = profile.userId
    displayName = profile.displayName
    decodedIDToken = ''
    #decodedIDToken = liff.getDecodedIDToken().email
    if (pictureUrl == undefined) {
        pictureUrl = ''
    }

		}
		async function main() {
			
			liff.ready.then(() => {
        if (liff.isLoggedIn()) {
            getUserProfile()
        } else {
            liff.login()
        }
    })
			await liff.init({ liffId: "1657908358-4W0Ezw8j"})
			await liff.shareTargetPicker([
			{
				type: "flex",
				altText: "แชร์เข้าฟรี",
				contents: 
				
        {
  "type": "carousel",
  "contents": [
    {
      "type": "bubble",
      "hero": {
        "type": "image",
        "url": "https://user-images.githubusercontent.com/84266946/180611999-aa5bdae3-6d8a-4749-ae81-8b9ba406976c.jpg",
        "size": "full",
        "aspectRatio": "1:1",
        "aspectMode": "cover"
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Brown Cafe",
            "weight": "bold",
            "size": "xl",
            "contents": []
          },
          {
            "type": "text",
            "text": "hello, world",
            "contents": []
          }
        ]
      },
      "footer": {
        "type": "box",
        "layout": "vertical",
        "flex": 0,
        "spacing": "sm",
        "contents": [
          {
            "type": "button",
            "action": {
              "type": "uri",
              "label": "แชร์เข้าฟรี",
              "uri": "https://liff.line.me/1657908358-4W0Ezw8j"
            },
            "height": "md",
            "style": "primary"
          },
          {
            "type": "separator"
          },
          {
            "type": "button",
            "action": {
              "type": "uri",
              "label": "เข้ากลุ่มไลฟ์",
              "uri": "https://linecorp.com"
            },
            "height": "md",
            "style": "secondary"
          }
        ]
      }
    },
    {
      "type": "bubble",
      "hero": {
        "type": "image",
        "url": "https://user-images.githubusercontent.com/84266946/180611999-aa5bdae3-6d8a-4749-ae81-8b9ba406976c.jpg",
        "size": "full",
        "aspectRatio": "1:1",
        "aspectMode": "cover"
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Brown Cafe",
            "weight": "bold",
            "size": "xl",
            "contents": []
          },
          {
            "type": "text",
            "text": "hello, world",
            "contents": []
          }
        ]
      },
      "footer": {
        "type": "box",
        "layout": "vertical",
        "flex": 0,
        "spacing": "sm",
        "contents": [
          {
            "type": "button",
            "action": {
              "type": "uri",
              "label": "แชร์เข้าฟรี",
              "uri": "https://liff.line.me/1657908358-4W0Ezw8j"
            },
            "height": "md",
            "style": "primary"
          },
          {
            "type": "button",
            "action": {
              "type": "uri",
              "label": "เข้ากลุ่มไลฟ์",
              "uri": "https://linecorp.com"
            },
            "height": "md",
            "style": "secondary"
          },
          {
            "type": "spacer",
            "size": "sm"
          }
        ]
      }
    }
  ]
}
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				}
			]).then(async function (res) {
      if (res) {
        // succeeded in sending a message through TargetPicker
        // console.log(`[${res.status}] Message sent!`)
	  if (liff.getContext().type !== "none" && liff.getContext().type !== "external") {
    await liff.sendMessages([
      {
        "type": "text",
        "text": "แชร์ห้องแห่งความลับ"
      }
    ])
    // $('#demo').html('แชร์สำเร็จ สิ้นสุดการแชร์ กรุณารอสักครู่')
  }
	// await makeRequest('GET', "https://script.google.com/macros/s/AKfycbwLOzsRg5iw7OVQHGjwcO0Fk-xxH0xR96HvXdGUWBu8dYZuv7mqaa0jrGMpDZQ7-REBcQ/exec?userId=" + userId + "&name=" + displayName +"&decode=" + decodedIDToken +"&pictureUrl=0")
        await liff.closeWindow()
      } else {
        const [majorVer, minorVer] = (liff.getLineVersion() || "").split('.');
        if (parseInt(majorVer) == 10 && parseInt(minorVer) < 11) {
          // LINE 10.3.0 - 10.10.0
          // Old LINE will access here regardless of user's action
          // $('#demo').html('เกิดข้อผิดพลาด ระบบไม่นับการแชร์ โปรดอัพเดท LINE ให้เป็นเวอร์ชั่นล่าสุด')
		await liff.closeWindow()
	
        } else {
          // LINE 10.11.0 -
          // sending message canceled
          // $('#demo').html('การแชร์สิ้นสุด ระบบจะไม่นับการแชร์')
		await liff.closeWindow()
        }
      }
    }).catch(function (error) {
      // something went wrong before sending a message
      // $('#demo').html('ระบบกำลังปิดหน้าต่างอัตโนมัติ')
	setTimeout(function() {liff.closeWindow()}, 500);
    })	
			// await liff.closeWindow()
		

		}





$(document).ready(function() {
	  main();
});

</script>

  </body>
</html>
